<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IEx World - Happy Birthday Luoqi!</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="background-overlay"></div>
    
    <!-- IEx World Section -->
    <section class="iex-world">
        <!-- Top UI -->
        <div class="world-icon">üêº</div>
        <h2 class="world-title">IEx World</h2>
        <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Back to Home</button>
        
        <!-- Scattered Pandas -->
        <div class="pandas-container">
            <img src="images/panda_m.png" alt="Friend 1 Panda" class="panda-clickable panda-1" onclick="showMessage(1)">
            <img src="images/panda_m.png" alt="Friend 2 Panda" class="panda-clickable panda-2" onclick="showMessage(2)">
            <img src="images/panda_m.png" alt="Friend 3 Panda" class="panda-clickable panda-3" onclick="showMessage(3)">
            <img src="images/panda_m.png" alt="Friend 4 Panda" class="panda-clickable panda-4" onclick="showMessage(4)">
            <img src="images/panda_m.png" alt="Friend 5 Panda" class="panda-clickable panda-5" onclick="showMessage(5)">
            <img src="images/panda_m.png" alt="Friend 6 Panda" class="panda-clickable panda-6" onclick="showMessage(6)">
        </div>

        <!-- Message Display -->
        <div id="message-display" class="message-display hidden">
            <div class="rain" id="rain"></div>
            <div class="message-content">
                <button class="close-btn" onclick="hideMessage()">√ó</button>
                <h3 id="message-sender"></h3>
                <p id="message-text"></p>
            </div>
        </div>
    </section>

    <script>
        const messages = {
            1: {
                sender: "Ellery",
                text: "happy birthday luoqi!! really glad we got to meet through iex lol you have such a unique energy like you'll be looking so seriously at ur phone and then it's some goofy meme or cute animal video HAHA anw sorry that i can't be there to celebrate in person :( can't wait to see u agn once 2026 rolls around hehe. here's to another great year ahead for u!!"
            },
            2: {
                sender: "Trang", 
                text: "Harlo! Happy Birthday sir üòá I guess being one year older isn't so fun cos it's one year further away from 2010 LOL but yes I hope you are content with where you are at in life and enjoying life while you can. You are really hard working and I really respect you for that. I just hope that you will be able to take a breather once in a while and live life as you have always wanted! Sometimes it just hit me that the 2 year of residency is over and I guess it will be harder to have more impromptu plans and bump into each other in the DH saddd :( owell but I just want to say I really treasure our friendship and the friendship with people in IEx. Thank you for always being so so so supportive. You have been there at my highest and at my lowest too and I am grateful for having you in my life. Thanks for putting up with my annoying shit HAHA (u are not fat) and thanks for being such a wonderful human being! I really mean it when I said everyone needs a Luoqi in their life. So happy birthday!! I am sorry that we can't physically celebrate your birthday, but always remember that you have a lot of people who believe in you and fight for you!"
            },
            3: {
                sender: "Justin",
                text: "Hey man! Happy birthday:) Hope you have a good one"
            },
            4: {
                sender: "Chloe",
                text: "hi luoqi, happy birthday!! i hope you're doing well in sg (while the rest of our iex are overseas). thank you for tanking so much work for iex/being so active despite being the only one supposedly academically focused/on intern this sem. even so, i hope you've been enjoying your intern this sem (if not the intensity/tiringness of it, at least the interest/skills you've acquired in it). been very fun to text you more over this summer, so even when our iex is over (omg can you believe we're almost at the end of our iex), i hope that our iex continues on as friends (even more iex meetings turned dinner/supper/bfast jios?). even if so many of us aren't in sg still, i hope you know our best wishes/spirits are (suffering) in sg with you. "
            },
            5: {
                sender: "Ziying",
                text: "hello luoqi happy birthday!!! thanks for being a part of iex! you're very steady and calm and idk you just have the ability to make us focus on what we need to do when we get distracted HAHAH and i rly appreciate that  it's also really funny when we get to tease you abt stuff HAHAH hope that everything goes well for u in the year ahead!! üòÅ"
            },
            6: {
                sender: "Kenneth",
                text: "Wishing you an epic birthday adventure, Luoqi! Time to celebrate!"
            }
        };

        let isDragging = false;
        let currentPanda = null;
        let startX = 0;
        let startY = 0;
        let startLeft = 0;
        let startTop = 0;

        // Load saved positions from localStorage
        function loadPandaPositions() {
            const savedPositions = localStorage.getItem('pandaPositions');
            if (savedPositions) {
                const positions = JSON.parse(savedPositions);
                Object.keys(positions).forEach(pandaId => {
                    const panda = document.querySelector(`.panda-${pandaId}`);
                    if (panda && positions[pandaId]) {
                        panda.style.left = positions[pandaId].left;
                        panda.style.top = positions[pandaId].top;
                        panda.style.right = 'auto';
                    }
                });
            }
        }

        // Save current positions to localStorage
        function savePandaPositions() {
            const positions = {};
            for (let i = 1; i <= 6; i++) {
                const panda = document.querySelector(`.panda-${i}`);
                if (panda) {
                    positions[i] = {
                        left: panda.style.left || getComputedStyle(panda).left,
                        top: panda.style.top || getComputedStyle(panda).top
                    };
                }
            }
            localStorage.setItem('pandaPositions', JSON.stringify(positions));
        }

        // Initialize drag functionality
        function initializeDragDrop() {
            const pandas = document.querySelectorAll('.panda-clickable');
            
            pandas.forEach(panda => {
                // Mouse events
                panda.addEventListener('mousedown', startDrag);
                
                // Touch events for mobile
                panda.addEventListener('touchstart', startDrag, { passive: false });
            });

            // Global mouse/touch events
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('touchend', endDrag);
        }

        function startDrag(e) {
            e.preventDefault();
            
            const event = e.type === 'touchstart' ? e.touches[0] : e;
            currentPanda = e.target;
            isDragging = true;
            
            // Get initial positions
            startX = event.clientX;
            startY = event.clientY;
            
            const rect = currentPanda.getBoundingClientRect();
            startLeft = rect.left;
            startTop = rect.top;
            
            // Visual feedback
            currentPanda.style.cursor = 'grabbing';
            currentPanda.style.opacity = '0.8';
            currentPanda.style.zIndex = '1000';
            
            // Prevent message popup during drag
            currentPanda.onclick = null;
        }

        function drag(e) {
            if (!isDragging || !currentPanda) return;
            
            e.preventDefault();
            const event = e.type === 'touchmove' ? e.touches[0] : e;
            
            // Calculate new position
            const deltaX = event.clientX - startX;
            const deltaY = event.clientY - startY;
            
            const newLeft = startLeft + deltaX;
            const newTop = startTop + deltaY;
            
            // Boundary checking
            const container = document.querySelector('.iex-world');
            const containerRect = container.getBoundingClientRect();
            const pandaRect = currentPanda.getBoundingClientRect();
            
            const minLeft = 0;
            const maxLeft = containerRect.width - pandaRect.width;
            const minTop = 0;
            const maxTop = containerRect.height - pandaRect.height;
            
            const boundedLeft = Math.max(minLeft, Math.min(maxLeft, newLeft));
            const boundedTop = Math.max(minTop, Math.min(maxTop, newTop));
            
            // Convert to percentage for responsive design
            const leftPercent = (boundedLeft / containerRect.width) * 100;
            const topPercent = (boundedTop / containerRect.height) * 100;
            
            // Update position
            currentPanda.style.left = leftPercent + '%';
            currentPanda.style.top = topPercent + '%';
            currentPanda.style.right = 'auto';
        }

        function endDrag(e) {
            if (!isDragging || !currentPanda) return;
            
            isDragging = false;
            
            // Reset visual feedback
            currentPanda.style.cursor = 'pointer';
            currentPanda.style.opacity = '1';
            currentPanda.style.zIndex = '10';
            
            // Restore click functionality after a brief delay
            const pandaId = currentPanda.classList[1].split('-')[1]; // Extract number from panda-X class
            setTimeout(() => {
                currentPanda.onclick = () => showMessage(parseInt(pandaId));
            }, 100);
            
            // Save new position
            savePandaPositions();
            
            currentPanda = null;
        }

        function showMessage(friendId) {
            if (isDragging) return; // Don't show message if we're dragging
            
            const messageDisplay = document.getElementById('message-display');
            const messageSender = document.getElementById('message-sender');
            const messageText = document.getElementById('message-text');
            
            const message = messages[friendId];
            messageSender.textContent = message.sender;
            messageText.textContent = message.text;
            
            startRain();
            messageDisplay.classList.remove('hidden');
        }

        function hideMessage() {
            const messageDisplay = document.getElementById('message-display');
            messageDisplay.classList.add('hidden');
            stopRain();
        }

        function startRain() {
            const rain = document.getElementById('rain');
            rain.innerHTML = ''; // Clear existing rain
            
            // Create 10 falling pandas
            for (let i = 0; i < 10; i++) {
                const rainItem = document.createElement('img');
                rainItem.src = 'images/panda_m.png';
                rainItem.className = 'rain-item';
                rain.appendChild(rainItem);
            }
        }

        function stopRain() {
            const rain = document.getElementById('rain');
            rain.innerHTML = '';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadPandaPositions();
            initializeDragDrop();
        });
    </script>
</body>
</html>