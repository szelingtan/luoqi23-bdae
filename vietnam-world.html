<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOC World - Happy Birthday Luoqi!</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="background-overlay"></div>
    
    <!-- NOC World Section -->
    <section class="vietnam-world">
        <!-- Top UI -->
        <div class="world-icon">üê±</div>
        <h2 class="world-title">NOC World</h2>
        <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Back to Home</button>
        
        <!-- Scattered Cats -->
        <div class="cats-container">
            <img src="images/cat_m.png" alt="Friend 7 Cat" class="cat-clickable cat-1" onclick="showMessage(7)">
            <img src="images/cat_m.png" alt="Friend 8 Cat" class="cat-clickable cat-2" onclick="showMessage(8)">
            <img src="images/cat_m.png" alt="Friend 9 Cat" class="cat-clickable cat-3" onclick="showMessage(9)">
            <img src="images/cat_m.png" alt="Friend 10 Cat" class="cat-clickable cat-4" onclick="showMessage(10)">
            <img src="images/cat_m.png" alt="Friend 11 Cat" class="cat-clickable cat-5" onclick="showMessage(11)">
            <img src="images/cat_m.png" alt="Friend 12 Cat" class="cat-clickable cat-6" onclick="showMessage(12)">
        </div>

        <!-- Message Display -->
        <div id="message-display" class="message-display hidden">
            <div class="rain" id="rain"></div>
            <div class="message-content">
                <button class="close-btn" onclick="hideMessage()">√ó</button>
                <h3 id="message-sender"></h3>
                <p id="message-text"></p>
            </div>
        </div>
    </section>

    <script>
        const messages = {
            7: {
                sender: "Sutong",
                text: "Happy Birthday Luoqi! Can't believe it's been a year since I've met you, time really flies! I'm really glad to have went on trips and do hackathons with you. You are someone we can always rely on, so it's really comforting to have you. I hope you achieve all your dreams in the year to come and see you back in Singapore soon!"
            },
            8: {
                sender: "Nicholas", 
                text: "HAPPY BIRTHDAY LUOQI!!!!!! stay cool as always and congrats for surviving the past 23 years of ur life !!!"
            },
            9: {
                sender: "Zien",
                text: "happy bday luoqi! to my literal roommate in vietnam, couldnt have asked for a btr roommate and housemates. you def made the trip more fun with your sometimes deadpan humour but also definitely made the trip must more memorable for me, being done with some people's shenanigans and being vv responsible also. looking back at some photos, i realised we actl spent so much time tgt in vietnam but didnt feel like it because time just flew by swhen youre having fun fr. really glad to have met you and hope we can all catch up real soon HAVE A GREAT BDAY!"
            },
            10: {
                sender: "Val",
                text: "Happy Birthday, Luoqi! Keep enjoying your tea and sharing your wisdom. Have a wonderful 23rd, old man!"
            },
            11: {
                sender: "Ying Xiu",
                text: "Happy Birthday Luoqi!! Thanks for being such a great friend who is always there for us in Vietnam and even till now. Super grateful how we still kept in touch even after one year! You are so slayyy and can't wait to see where you'll progress :) All the best in whatever you do!! 23 years old already ü§£  don't bully szeling too much okayy!! have a blessed birthday :))"
            },
            12: {
                sender: "Eunice",
                text: "helloooo!! HAPPY BIRTHDAY LUOQI!! wishing u good health, good luck and may all ur birthday wishes come thru. I‚Äôm not good at birthday wishes but just wanted to wish u a happy happy birthday!"
            }
        };

        let isDragging = false;
        let currentCat = null;
        let startX = 0;
        let startY = 0;
        let startLeft = 0;
        let startTop = 0;

        // Load saved positions from localStorage
        function loadCatPositions() {
            const savedPositions = localStorage.getItem('catPositions');
            if (savedPositions) {
                const positions = JSON.parse(savedPositions);
                Object.keys(positions).forEach(catId => {
                    const cat = document.querySelector(`.cat-${catId}`);
                    if (cat && positions[catId]) {
                        cat.style.left = positions[catId].left;
                        cat.style.top = positions[catId].top;
                        cat.style.right = 'auto';
                    }
                });
            }
        }

        // Save current positions to localStorage
        function saveCatPositions() {
            const positions = {};
            for (let i = 1; i <= 6; i++) {
                const cat = document.querySelector(`.cat-${i}`);
                if (cat) {
                    positions[i] = {
                        left: cat.style.left || getComputedStyle(cat).left,
                        top: cat.style.top || getComputedStyle(cat).top
                    };
                }
            }
            localStorage.setItem('catPositions', JSON.stringify(positions));
        }

        // Initialize drag functionality
        function initializeDragDrop() {
            const cats = document.querySelectorAll('.cat-clickable');
            
            cats.forEach(cat => {
                // Mouse events
                cat.addEventListener('mousedown', startDrag);
                
                // Touch events for mobile
                cat.addEventListener('touchstart', startDrag, { passive: false });
            });

            // Global mouse/touch events
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('touchend', endDrag);
        }

        function startDrag(e) {
            e.preventDefault();
            
            const event = e.type === 'touchstart' ? e.touches[0] : e;
            currentCat = e.target;
            isDragging = true;
            
            // Get initial positions
            startX = event.clientX;
            startY = event.clientY;
            
            const rect = currentCat.getBoundingClientRect();
            startLeft = rect.left;
            startTop = rect.top;
            
            // Visual feedback
            currentCat.style.cursor = 'grabbing';
            currentCat.style.opacity = '0.8';
            currentCat.style.zIndex = '1000';
            
            // Prevent message popup during drag
            currentCat.onclick = null;
        }

        function drag(e) {
            if (!isDragging || !currentCat) return;
            
            e.preventDefault();
            const event = e.type === 'touchmove' ? e.touches[0] : e;
            
            // Calculate new position
            const deltaX = event.clientX - startX;
            const deltaY = event.clientY - startY;
            
            const newLeft = startLeft + deltaX;
            const newTop = startTop + deltaY;
            
            // Boundary checking
            const container = document.querySelector('.vietnam-world');
            const containerRect = container.getBoundingClientRect();
            const catRect = currentCat.getBoundingClientRect();
            
            const minLeft = 0;
            const maxLeft = containerRect.width - catRect.width;
            const minTop = 0;
            const maxTop = containerRect.height - catRect.height;
            
            const boundedLeft = Math.max(minLeft, Math.min(maxLeft, newLeft));
            const boundedTop = Math.max(minTop, Math.min(maxTop, newTop));
            
            // Convert to percentage for responsive design
            const leftPercent = (boundedLeft / containerRect.width) * 100;
            const topPercent = (boundedTop / containerRect.height) * 100;
            
            // Update position
            currentCat.style.left = leftPercent + '%';
            currentCat.style.top = topPercent + '%';
            currentCat.style.right = 'auto';
        }

        function endDrag(e) {
            if (!isDragging || !currentCat) return;
            
            isDragging = false;
            
            // Reset visual feedback
            currentCat.style.cursor = 'pointer';
            currentCat.style.opacity = '1';
            currentCat.style.zIndex = '10';
            
            // Restore click functionality after a brief delay
            const catId = currentCat.classList[1].split('-')[1]; // Extract number from cat-X class
            setTimeout(() => {
                currentCat.onclick = () => showMessage(parseInt(catId) + 6); // cat-1 -> friend 7, cat-2 -> friend 8, etc.
            }, 100);
            
            // Save new position
            saveCatPositions();
            
            currentCat = null;
        }

        function showMessage(friendId) {
            if (isDragging) return; // Don't show message if we're dragging
            
            const messageDisplay = document.getElementById('message-display');
            const messageSender = document.getElementById('message-sender');
            const messageText = document.getElementById('message-text');
            
            const message = messages[friendId];
            messageSender.textContent = message.sender;
            messageText.textContent = message.text;
            
            startRain();
            messageDisplay.classList.remove('hidden');
        }

        function hideMessage() {
            const messageDisplay = document.getElementById('message-display');
            messageDisplay.classList.add('hidden');
            stopRain();
        }

        function startRain() {
            const rain = document.getElementById('rain');
            rain.innerHTML = ''; // Clear existing rain
            
            // Create 10 falling cats
            for (let i = 0; i < 10; i++) {
                const rainItem = document.createElement('img');
                rainItem.src = 'images/cat_m.png';
                rainItem.className = 'rain-item';
                rain.appendChild(rainItem);
            }
        }

        function stopRain() {
            const rain = document.getElementById('rain');
            rain.innerHTML = '';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadCatPositions();
            initializeDragDrop();
        });
    </script>
</body>
</html>